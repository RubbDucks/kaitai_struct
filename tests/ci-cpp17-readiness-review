#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

"$ROOT_DIR/tests/migration_golden/validate_cpp17_readiness_checklist.py"
"$ROOT_DIR/tests/migration_golden/validate_cpp17_gate_examples.py"
"$ROOT_DIR/tests/ci-cpp17-differential"
"$ROOT_DIR/tests/migration_golden/run_cpp17_benchmarks.py" \
  --fixtures "$ROOT_DIR/tests/migration_golden/benchmark_fixtures.tsv" \
  --output-dir "$ROOT_DIR/tests/test_out/migration_benchmarks" \
  --latency-ratio-max 2.0 \
  --memory-ratio-max 2.0 \
  --stability-cv-max 0.20
"$ROOT_DIR/tests/migration_golden/run_cpp17_benchmarks.py" \
  --check-schema "$ROOT_DIR/tests/test_out/migration_benchmarks/report.json"
